fs = require 'fs'
coffee = require 'coffee-script'
browserify = require 'browserify'
{spawn} = require 'child_process'

replacements = [
  [ '== typeof ', '=== typeof ' ]
  [ '!= typeof ', '!== typeof ' ]
]


task 'build', ->
  data = coffee.compile(fs.readFileSync('src/bongo.coffee', 'utf-8'), bare: yes)
  code = data+''

  for _, [replacement, was] of replacements
    code = code.replace was, replacement

  fs.writeFile 'bongo.js', code, (err)->
    throw err if err
    fs.writeFile 'browser/bongo.js', "!function(){\n#{browserify('bongo.js').bundle()}\n}();", (err)->
      throw err if err
      console.log 'build complete'
